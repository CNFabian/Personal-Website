version: 1
frontend:
  phases:
    preBuild:
      commands:
        # Cache Node.js installation
        - if ! command -v node > /dev/null; then nvm install 20; fi
        - nvm use 20
        - node -v
        # Cache node_modules and avoid unnecessary "yarn install" if the cache exists
        - if [ ! -d node_modules ]; then yarn install; else echo "Using cached node_modules"; fi
    build:
      commands:
        # Use caching to avoid re-running the build if the build directory is unchanged
        - if [ ! -d build ]; then yarn build; else echo "Using cached build files"; fi
  artifacts:
    baseDirectory: build
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - build/**/*
      - ~/.nvm/versions/node/**/*
